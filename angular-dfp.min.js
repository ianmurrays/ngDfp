angular.module("ngDfp",[]).constant("ngDfpUrl","//www.googletagservices.com/tag/js/gpt.js").provider("DoubleClick",["ngDfpUrl",function(e){var c={},g={},d={},l=null,k=!0;this._createTag=function(a){if(k){var b=document.createElement("script"),f="https:"===document.location.protocol,d=document.getElementsByTagName("script")[0];b.async=!0;b.type="text/javascript";b.src=(f?"https:":"http:")+e;d.parentNode.insertBefore(b,d);b.onreadystatechange=function(){"complete"==this.readyState&&a()};b.onload=a}};
this._initialize=function(a){angular.forEach(c,function(b,f){g[f]=a.googletag.defineSlot.apply(null,b).addService(a.googletag.pubads());d[f]&&g[f].defineSizeMapping(d[f])});a.googletag.pubads().enableSingleRequest();a.googletag.enableServices();a.googletag.pubads().addEventListener("slotRenderEnded",this._slotRenderEnded)};this._slotRenderEnded=function(a){a=c[a.slot.getSlotId().getDomId()].renderCallback;"function"===typeof a&&a()};this._refreshInterval=function(){return l};this.setRefreshInterval=
function(a){l=a;return this};this.defineSlot=function(){var a=arguments;a.getSize=function(){return this[1]};a.setRenderCallback=function(a){this.renderCallback=a};c[arguments[2]]=a;return this};this.defineSizeMapping=function(a){d[a]||(d[a]=[]);this.addSize=function(b,f){d[a].push([b,f]);return this};return this};this.setEnabled=function(a){k=a};var h=this;this.$get=["$q","$window","$interval",function(a,b,d){var e=a.defer();h._createTag(function(){h._initialize(b);null!==h._refreshInterval()&&d(function(){b.googletag.pubads().refresh()},
h._refreshInterval());e.resolve()});return{getAdSize:function(a){return e.promise.then(function(){if(angular.isUndefined(c[a]))throw"Slot "+a+" has not been defined. Define it using DoubleClickProvider.defineSlot().";return c[a][1]})},getSlot:function(a){return e.promise.then(function(){if(angular.isUndefined(c[a]))throw"Slot "+a+" has not been defined. Define it using DoubleClickProvider.defineSlot().";return c[a]})},runAd:function(a){b.googletag.display(a)},refreshAds:function(){var a=[];angular.forEach(arguments,
function(b){a.push(g[b])});b.googletag.pubads().refresh(a)}}}]}]).directive("ngDfpAdContainer",function(){return{restrict:"A",controller:["$element",function(e){this.$$setVisible=function(c,g){c?"visibility"===g?e.css("visibility","visible"):e.show():"visibility"===g?e.css("visibility","hidden"):e.hide()}}]}}).directive("ngDfpAd",["$timeout","$parse","$interval","DoubleClick",function(e,c,g,d){return{restrict:"A",template:'<div id="{{adId}}"></div>',require:"?^ngDfpAdContainer",scope:{adId:"@ngDfpAd",
refresh:"@ngDfpAdRefresh",interval:"@ngDfpAdRefreshInterval",timeout:"@ngDfpAdRefreshTimeout"},replace:!0,link:function(c,k,h,a){c.$watch("adId",function(b){k.html("");var f=null;d.getSlot(b).then(function(m){var n=m.getSize();k.css("width",n[0]).css("height",n[1]);e(function(){d.runAd(b)});a&&m.setRenderCallback(function(){angular.isDefined(h.ngDfpAdHideWhenEmpty)&&(0===k.find("iframe:not([id*=hidden])").map(function(){return this.contentWindow.document}).find("body").children().length?a.$$setVisible(!1,
h.ngDfpAdHideWhenEmpty):a.$$setVisible(!0,h.ngDfpAdHideWhenEmpty))});c.$watch("refresh",function(a){angular.isUndefined(a)||d.refreshAds(b)});c.$watch("interval",function(a){angular.isUndefined(a)||(g.cancel(f),f=g(function(){d.refreshAds(b)},c.interval))});c.$watch("timeout",function(a){angular.isUndefined(a)||e(function(){d.refreshAds(b)},c.timeout)})})})}}}]);
